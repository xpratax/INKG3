<!DOCTYPE html>
<!--n√£o a nada para besta ver no meu codigo fonteüñï  -->
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>INK#3</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
    body {
        font-family: Arial, sans-serif;
        background: #111;
        color: #fff;
        padding: 20px;
    }
    .box {
        background: #1a1a1a;
        padding: 20px;
        margin-bottom: 20px;
        border-radius: 12px;
        box-shadow: 0 0 10px #000;
    }
    input, button {
        width: 100%;
        padding: 10px;
        margin-top: 10px;
        border-radius: 8px;
        border: none;
    }
    button {
        background: #32cd32;
        color: #000;
        cursor: pointer;
        font-weight: bold;
    }
    button:hover {
        background: #2daa2d;
    }
    a {
        color: #32cd32;
        text-decoration: none;
        font-weight: bold;
    }

    /* POL√çTICAS - modal */
    #politicasModal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.85);
        padding: 20px;
        overflow-y: auto;
    }
    #politicasContent {
        background: #1a1a1a;
        padding: 20px;
        border-radius: 12px;
        max-width: 700px;
        margin: auto;
        margin-top: 40px;
    }
</style>
</head>
<body>

<h1>IG3k üé´</h1>
<p>Plataforma de vendas + comissionamento de ingressos.</p>

<!-- CAIXA DE POL√çTICAS -->
<div id="politicasBox" class="box" style="display:none;">
    <h2>üìú Pol√≠ticas de Privacidade</h2>
    <p>Para continuar utilizando a plataforma, voc√™ deve aceitar as pol√≠ticas.</p>

    <button onclick="abrirPoliticas()">Ler Pol√≠ticas Completas</button>
    <button onclick="aceitarPoliticas()">Aceitar e Continuar ‚úî</button>
</div>

<!-- MODAL POL√çTICAS -->
<div id="politicasModal">
    <div id="politicasContent">
        <h2>üìú Pol√≠ticas de Privacidade ‚Äî Cact Ingressos</h2>

        <p>
        Esta plataforma registra as vendas de ingressos associadas ao seu usu√°rio,
        incluindo tipo do ingresso, valor, data e comiss√£o gerada.  
        Sua comiss√£o √© vari√°vel e **N√ÉO √© permanente**, podendo acabar a qualquer momento sem aviso pr√©vio.
        </p>

        <h3>üìå Coleta de Dados</h3>
        <p>
            ‚Ä¢ Nome e email cadastrados<br>
            ‚Ä¢ Ingressos vendidos<br>
            ‚Ä¢ Comiss√£o gerada em cada venda
        </p>

        <h3>üìå Uso dos Dados</h3>
        <p>
            Os dados s√£o usados exclusivamente para:  
            ‚Ä¢ Exibir suas vendas  
            ‚Ä¢ Calcular sua comiss√£o  
            ‚Ä¢ Melhorar o sistema
        </p>

        <h3>üìå Comiss√£o n√£o permanente</h3>
        <p>
            A comiss√£o pode existir por tempo limitado.  
            Futuramente poder√° ser removida, reduzida ou substitu√≠da, sem compensa√ß√£o ou obriga√ß√£o posterior.
        </p>

        <h3>üìå Exclus√£o de Dados</h3>
        <p>
            Voc√™ pode solicitar remo√ß√£o do seu usu√°rio e dados a qualquer momento.
        </p>

        <button onclick="fecharPoliticas()">Fechar</button>
    </div>
</div>

<!-- LOGIN -->
<div id="loginBox" class="box" style="display:none;">
    <h2>Entrar</h2>
    <input type="email" id="loginEmail" placeholder="Email">
    <input type="password" id="loginSenha" placeholder="Senha">
    <button onclick="login()">Entrar</button>
    <p>N√£o tem conta? <a href="#" onclick="showCadastro()">Criar conta</a></p>
</div>

<!-- CADASTRO -->
<div id="cadastroBox" class="box" style="display:none;">
    <h2>Criar Conta</h2>
    <input type="text" id="cadNome" placeholder="Nome completo">
    <input type="email" id="cadEmail" placeholder="Email">
    <input type="password" id="cadSenha" placeholder="Senha">
    <button onclick="cadastro()">Cadastrar</button>
    <p>J√° tem conta? <a href="#" onclick="showLogin()">Entrar</a></p>
</div>

<!-- DASHBOARD -->
<div id="dashboard" class="box" style="display:none;">
    <h2>Bem-vindo, <span id="userNome"></span> üëã</h2>
    <button onclick="logout()">Sair</button>

    <h3>Seus ingressos vendidos</h3>
    <div id="listaIngressos">Carregando...</div>

    <h3>Total em comiss√£o üí∏</h3>
    <p id="comissaoTotal">Calculando...</p>
</div>

<script>
/* ============================ */
/* ===== SUPABASE CONFIG ====== */
/* ============================ */

const supabase = supabase.createClient(
    "https://nmbslklretjxqowhvotr.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVuZG1vamRxcG5teGZhcG10eGlrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2NzgxMjUsImV4cCI6MjA3OTI1NDEyNX0.HMZYxnIsUDC93qjdG0LKbZMT6w0g9DwJ1-tDEaaHNvc"
);

/* ============================ */
/* ===== SISTEMA POL√çTICAS ==== */
/* ============================ */

function checkPoliticas() {
    const aceito = localStorage.getItem("politicasAceitas");
    if (!aceito) {
        document.getElementById("politicasBox").style.display = "block";
        return false;
    }
    return true;
}

function aceitarPoliticas() {
    localStorage.setItem("politicasAceitas", "true");
    alert("Obrigado! Agora voc√™ pode usar a plataforma.");
    location.reload();
}

function abrirPoliticas() {
    document.getElementById("politicasModal").style.display = "block";
}

function fecharPoliticas() {
    document.getElementById("politicasModal").style.display = "none";
}

/* ============================ */
/* ======= LOGIN / CADASTRO === */
/* ============================ */

function showLogin() {
    document.getElementById("loginBox").style.display = "block";
    document.getElementById("cadastroBox").style.display = "none";
}
function showCadastro() {
    document.getElementById("loginBox").style.display = "none";
    document.getElementById("cadastroBox").style.display = "block";
}

async function login() {
    const email = document.getElementById("loginEmail").value;
    const senha = document.getElementById("loginSenha").value;

    const { data, error } = await supabase.auth.signInWithPassword({
        email,
        password: senha
    });

    if (error) return alert(error.message);
    location.reload();
}

async function cadastro() {
    const nome = document.getElementById("cadNome").value;
    const email = document.getElementById("cadEmail").value;
    const senha = document.getElementById("cadSenha").value;

    const { data, error } = await supabase.auth.signUp({
        email,
        password: senha
    });

    if (error) return alert(error.message);

    await supabase.from("profiles").insert({
        id: data.user.id,
        nome: nome
    });

    alert("Conta criada! Agora fa√ßa login.");
    showLogin();
}

/* ============================ */
/* ====== DASHBOARD =========== */
/* ============================ */

async function carregarDashboard() {
    const { data: session } = await supabase.auth.getSession();
    if (!session.session) {
        showLogin();
        return;
    }

    document.getElementById("dashboard").style.display = "block";

    const userId = session.session.user.id;

    const { data: perfil } = await supabase
        .from("profiles")
        .select("*")
        .eq("id", userId)
        .single();

    document.getElementById("userNome").innerText = perfil?.nome || "Usu√°rio";

    const { data: ingressos, error } = await supabase
        .from("cact_ingressos")
        .select("*")
        .eq("user_id", userId);

    if (error) {
        document.getElementById("listaIngressos").innerText = "Erro ao carregar";
        return;
    }

    if (!ingressos.length) {
        document.getElementById("listaIngressos").innerHTML = "<p>Nenhuma venda ainda...</p>";
    } else {
        let html = "";
        ingressos.forEach(i => {
            html += `<p>üé´ ${i.tipo} ‚Äî R$ ${i.valor} ‚Äî ${i.data}</p>`;
        });
        document.getElementById("listaIngressos").innerHTML = html;
    }

    let total = 0;
    ingressos.forEach(i => total += i.comissao_valor);

    document.getElementById("comissaoTotal").innerText = "R$ " + total.toFixed(2);
}

async function logout() {
    await supabase.auth.signOut();
    location.reload();
}

/* ============================ */
/* ===== INIT ================= */
/* ============================ */

window.onload = async () => {
    if (!checkPoliticas()) return;
    carregarDashboard();
};
</script>

</body>
</html>
